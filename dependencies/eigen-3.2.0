#!/bin/sh
#
# Setup Eigen 3.2.
#
set -e

# Directories.
root_dir=`pwd`
if [ -d debian ]; then
    install_dir="/tmp/_travis/install"
else
    install_dir="$root_dir/_travis/install"
fi

build_dir=`mktemp -d`
trap "rm -rf -- '$build_dir'" EXIT

# Setup environment variables.
export LD_LIBRARY_PATH="$install_dir/lib:$LD_LIBRARY_PATH"
export LD_LIBRARY_PATH="$install_dir/lib/`dpkg-architecture -qDEB_BUILD_MULTIARCH`:$LD_LIBRARY_PATH"
export PKG_CONFIG_PATH="$install_dir/lib/pkgconfig:$PKG_CONFIG_PATH"
export PKG_CONFIG_PATH="$install_dir/lib/`dpkg-architecture -qDEB_BUILD_MULTIARCH`/pkgconfig:$PKG_CONFIG_PATH"

# Checkout Eigen
cd "$build_dir"
wget --quiet "http://bitbucket.org/eigen/eigen/get/3.2.0.tar.gz"
tar xzf 3.2.0.tar.gz
cd "$build_dir/eigen-eigen-ffa86ffb5570/"
mkdir -p "$build_dir/eigen-eigen-ffa86ffb5570/_build"
cd "$build_dir/eigen-eigen-ffa86ffb5570/_build"
cmake .. -DCMAKE_INSTALL_PREFIX:STRING="$install_dir" \
	 -Dpkg_config_libdir:STRING="$install_dir/lib"
make
make install

# Check install
pkg-config --modversion eigen3
pkg-config --cflags eigen3
